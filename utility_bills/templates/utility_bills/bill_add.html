{% extends "utility_bills/base.html" %}
{% block content %}
<div class="card">
  <h2 style="margin:0">Add bill manually</h2>
  <p class="muted">Manual entry and OCR both save into the same models.</p>

  <div style="display:flex; gap:10px; margin-top:10px">
    <a class="btn secondary" href="{% url 'utility_bills:bill_add' %}?utility_type=electricity">Electricity form</a>
    <a class="btn secondary" href="{% url 'utility_bills:bill_add' %}?utility_type=water">Water form</a>
  </div>

  <div style="height:12px"></div>

  <form method="post">
    {% csrf_token %}

    <div class="row">
      <div>
        <label>Meter</label>
        <select name="meter_id" required>
          {% for m in meters %}
          <option value="{{ m.id }}">{{ m.meter_number }}{% if m.nickname %} - {{ m.nickname }}{% endif %}</option>
          {% endfor %}
        </select>
      </div>
      <div>
        <label>Period start</label>
        <input type="date" name="period_start" required />
      </div>
      <div>
        <label>Period end</label>
        <input type="date" name="period_end" required />
      </div>
      {% if utility_type == "electricity" %}
      <div>
        <label>Reading date (optional)</label>
        <input type="date" name="reading_date" />
      </div>
      {% endif %}
    </div>

    <div style="height:12px"></div>

    {% if utility_type == "electricity" %}
    <div class="card" style="margin:0; background:#f9fafb">
      <h3 style="margin-top:0">Electricity (solar / net-metering)</h3>
      <div class="row">
        <div><label>Imported previous</label><input type="number" name="import_previous" min="0" required /></div>
        <div><label>Imported current</label><input type="number" name="import_current" min="0" required /></div>
        <div><label>Exported previous (optional)</label><input type="number" name="export_previous" min="0" /></div>
        <div><label>Exported current (optional)</label><input type="number" name="export_current" min="0" /></div>
        <div><label>Billed kWh (optional)</label><input type="number" name="billed_kwh" /></div>
        <div><label>Total amount (JOD, optional)</label><input type="number" step="0.001" name="total_amount" /></div>
      </div>
      <p class="muted" style="margin-bottom:0">Net kWh = (import_current - import_previous) - (export_current - export_previous)</p>
    </div>
    {% else %}
    <div class="card" style="margin:0; background:#f9fafb">
      <h3 style="margin-top:0">Water</h3>
      <div class="row">
        <div><label>Previous reading</label><input type="number" name="previous_reading" min="0" required /></div>
        <div><label>Current reading</label><input type="number" name="current_reading" min="0" required /></div>
        <div><label>Billed mÂ³ (optional)</label><input type="number" name="billed_m3" /></div>
        <div><label>Total amount (JOD, optional)</label><input type="number" step="0.001" name="total_amount" /></div>
      </div>
    </div>
    {% endif %}

    <div style="height:12px"></div>
    <button class="btn" type="submit">Save bill</button>
  </form>
</div>
{% endblock %}
